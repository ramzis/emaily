!function(e){var n={};function r(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=n,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,n){if(1&n&&(e=r(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)r.d(t,o,function(n){return e[n]}.bind(null,o));return t},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.p="/",r(r.s=8)}([function(e,n){e.exports=require("passport")},function(e,n,r){e.exports=r(10)},function(e,n){e.exports=require("mongoose")},function(e,n){e.exports=require("express")},function(e,n){e.exports=require("cookie-session")},function(e,n){e.exports=require("body-parser")},function(e,n){e.exports=require("stripe")},function(e,n){e.exports=require("passport-google-oauth20")},function(e,n,r){r(9),e.exports=r(12)},function(e,n){e.exports=require("@babel/polyfill")},function(e,n,r){"use strict";r.r(n),n.default={googleClientID:process.env.GOOGLE_CLIENT_ID,googleClientSecret:process.env.GOOGLE_CLIENT_SECRET,mongoURI:process.env.MONGO_URI,cookieKey:process.env.COOKIE_KEY,stripePublishableKey:process.env.STRIPE_PUBLISHABLE_KEY,stripeSecretKey:process.env.STRIPE_SECRET_KEY}},function(e,n){e.exports=require("path")},function(e,n,r){"use strict";r.r(n);var t=r(3),o=r.n(t),i=r(2),u=r.n(i),s=r(4),c=r.n(s),a=r(0),l=r.n(a),f=r(5),p=r.n(f),d=r(1),g=r.n(d),v=function(e){e.get("/auth/google",l.a.authenticate("google",{scope:["profile","email"]})),e.get("/auth/google/callback",l.a.authenticate("google"),function(e,n){n.redirect("/surveys")}),e.get("/api/logout",function(e,n){e.logout(),n.redirect("/")}),e.get("/api/current_user",function(e,n){n.send(e.user)})},y=r(6),m=function(e,n,r){if(!e.user)return n.status(401).send({error:"You must log in!"});r()};function x(e,n,r,t,o,i,u){try{var s=e[i](u),c=s.value}catch(e){return void r(e)}s.done?n(c):Promise.resolve(c).then(t,o)}var b=r.n(y)()(g.a.stripeSecretKey),h=function(e){e.post("/api/stripe",m,(n=regeneratorRuntime.mark(function e(n,r){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.charges.create({amount:500,currency:"usd",description:"$5 for 5 credits",source:n.body.id});case 2:return e.sent,n.user.credits+=5,e.next=6,n.user.save();case 6:t=e.sent,r.send(t);case 8:case"end":return e.stop()}},e)}),r=function(){var e=this,r=arguments;return new Promise(function(t,o){var i=n.apply(e,r);function u(e){x(i,t,o,u,s,"next",e)}function s(e){x(i,t,o,u,s,"throw",e)}u(void 0)})},function(e,n){return r.apply(this,arguments)}));var n,r},_=new i.Schema({googleId:String,credits:{type:Number,default:0}});u.a.model("users",_);var S=r(7);function I(e,n,r,t,o,i,u){try{var s=e[i](u),c=s.value}catch(e){return void r(e)}s.done?n(c):Promise.resolve(c).then(t,o)}var O=u.a.model("users");l.a.serializeUser(function(e,n){n(null,e.id)}),l.a.deserializeUser(function(e,n){O.findById(e).then(function(e){n(null,e)})});l.a.use(new S.Strategy({clientID:g.a.googleClientID,clientSecret:g.a.googleClientSecret,callbackURL:"/auth/google/callback",proxy:!0},function(){var e,n=(e=regeneratorRuntime.mark(function e(n,r,t,o){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.findOne({googleID:t.id});case 2:if(i=e.sent){e.next=7;break}return e.next=6,new O({googleID:t.id}).save();case 6:i=e.sent;case 7:o(null,i);case 8:case"end":return e.stop()}},e)}),function(){var n=this,r=arguments;return new Promise(function(t,o){var i=e.apply(n,r);function u(e){I(i,t,o,u,s,"next",e)}function s(e){I(i,t,o,u,s,"throw",e)}u(void 0)})});return function(e,r,t,o){return n.apply(this,arguments)}}()));u.a.connect(g.a.mongoURI,{useNewUrlParser:!0},function(e){e&&console.log(e)});var E=o()();E.use(p.a.json()),E.use(c()({maxAge:2592e6,keys:[g.a.cookieKey]})),E.use(l.a.initialize()),E.use(l.a.session()),v(E),h(E);var P=r(11).join(__dirname,"../client","build");E.use(o.a.static(P)),E.get("*",function(e,n){n.sendFile("index.html",{root:P})});var w=process.env.PORT||5e3;E.listen(w)}]);